I"∫)<p>Sauda√ß√µes, atuo como desenvolvedor Full-Stack em uma empresa de Araraquara (SP), a wab.com.br. N√£o sou um expert em servidores e aplica√ß√µes atuando como tal. Por√©m gosto de estudar, ent√£o pratiquei sobre o assunto a qual os escrevo.</p>

<p>Iremos abordar os seguintes t√≥picos:</p>

<ol>
  <li>Introdu√ß√£o</li>
  <li>Funcionamento da replica√ß√£o (teoria)</li>
  <li>Como iremos replicar (esquema)</li>
  <li>Replicando um banco de dados MySQL (pr√°tica)</li>
</ol>

<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>

<p>A replica√ß√£o de bancos de dados tem como principal objetivo a <strong>redund√¢ncia</strong>, onde torna-se uma aplica√ß√£o mais segura contra falhas e <strong>indisponibilidades de outras aplica√ß√µes (como o respectivo banco de dados)</strong> e por sua vez um backup online dos dados (em tempo real). Nos t√≥picos abaixo estaremos abordando todos os processos de replica√ß√£o.</p>

<h2 id="como-funciona-a-replica√ß√£o">Como funciona a replica√ß√£o?</h2>

<p>O <strong>MySQL</strong> possui um recurso de comunica√ß√£o (onde ocorrer√° a replica√ß√£o) modo <strong>Master-Slave</strong>. Sendo assim, um servidor poder√° possuir um banco de dados MySQL rodando como <strong>Master</strong> e <strong>N</strong> bancos de dados atuando como <strong>Slave</strong> (em diferentes servidores).</p>

<p>O servidor atuando em modo <strong>Master</strong> ir√° gravar todas as altera√ß√µes efetuadas no banco de dados, em um arquivo de <strong>log bin√°rio</strong>. Onde o servidor atuando em modo <strong>Slave</strong> ir√° requisitar o log bin√°rio do <strong>Master</strong> e alterar√° o pr√≥prio arquivo de log bin√°rio deixando-o id√™ntico, onde o MySQL atual aplicando as altera√ß√µes em si.</p>

<p>Segue abaixo um esquema de replica√ß√£o <strong>Master-Slave</strong>:</p>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-mysql-replication.jpg" />
	<b>Figura 1.1 - Fonte: Google Images</b>
</div>

<h2 id="como-iremos-replicar-esquema">Como iremos replicar (esquema)</h2>

<p>Para a replica√ß√£o do <strong>MySQL</strong>, ser√° utilizado tr√™s inst√¢ncias <strong>t2.micro</strong> no <strong>Amazon AWS</strong>, conforme abaixo:</p>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-amazon-aws.png" />
	<br />
	<b>Inst√¢ncias - Figura 1.2</b>
</div>

<p><strong>Observa√ß√£o:</strong> Pode-se analisar na <strong>Figura 1.2</strong> (acima) que as tr√™s inst√¢ncias encontram-se no mesmo datacenter, por√©m a replica√ß√£o tamb√©m funciona em datacenters diferentes.</p>

<p>Onde os respectivos atuar√£o em modo:</p>

<ol>
  <li><strong>leonardorifeli-001:</strong> Master</li>
  <li><strong>leonardorifeli-002:</strong> Slave</li>
  <li><strong>leonardorifeli-003:</strong> Slave</li>
</ol>

<p>Conforme esquema abaixo:</p>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-server-aws-mysql-replication.png" />
	<br />
	<b>Figura 1.3</b>
</div>

<p><strong>PS</strong>: N√£o entrarei em detalhes sobre o Amazon AWS.</p>

<h2 id="replicando-um-banco-de-dados-mysql">Replicando um banco de dados MySQL</h2>

<p>Vamos ao t√£o esperado t√≥pico.</p>

<p>As inst√¢ncias especificadas na <strong>Figura 1.2</strong> est√£o rodando com o sistema operacional <strong>Ubuntu Server 14.04 LTS (HVM), SSD Volume Type</strong>, disponibilizado pelo Amazon AWS.</p>

<p>Para a replica√ß√£o do banco de dados <strong>MySQL</strong> ser√° necess√°rio a instala√ß√£o da respectiva aplica√ß√£o (√≥bvio). Neste post foi utilizado o <strong>mysql-server-5.6</strong>. <a href="http://sharadchhetri.com/2014/05/07/install-mysql-server-5-6-ubuntu-14-04-lts-trusty-tahr/" target="_blank">Tutorial de instala√ß√£o</a></p>

<p>Iremos aplicar os seguintes passos:</p>

<ol>
  <li><strong>Servidor Master:</strong> Configurar o servidor Master (arquivo my.cnf)</li>
  <li><strong>Servidor Master:</strong> Criar o usu√°rio de replica√ß√£o e conceder as devidas permiss√µes</li>
  <li><strong>Servidores Slaves:</strong> Configurar o servidor (arquivo my.cnf)</li>
  <li><strong>Servidores Slaves:</strong> Informar qual ser√° o servidor <strong>Master</strong></li>
</ol>

<h4 id="1-configura√ß√£o-do-servidor-master">1. Configura√ß√£o do servidor Master</h4>

<p>Ap√≥s a instala√ß√£o com sucesso do <strong>MySQL Server 5.6</strong> nas inst√¢ncias especificadas na <strong>Figura 1.2</strong>, vamos as respectivas configura√ß√µes na inst√¢ncia <strong>leonardorifeli-001</strong> que atuar√° em modo <strong>Master</strong>.</p>

<p>Configurando:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> /etc/mysql
<span class="nv">$ </span>nano my.cnf</code></pre></figure>

<p>Ser√° necess√°rio editar o arquivo <strong>my.cnf</strong>, ficando da seguinte maneira:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">[mysqld]

server-id = 1
log-bin = mysql-bin
bind-address = 0.0.0.0</code></pre></figure>

<p>Indicamos que o respectivo servidor ser√° o <strong>Master</strong> (pelo server-id). Ap√≥s editar, executamos o comando abaixo (para reiniciar o servidor MySQL):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>service mysql restart</code></pre></figure>

<h4 id="2-criar-usu√°rio-de-replica√ß√£o-e-conceder-as-permiss√µes">2. Criar usu√°rio de replica√ß√£o e conceder as permiss√µes</h4>

<p>Agora, iremos criar o usu√°rio para utilizarmos na replica√ß√£o e conceder para tal as devidas permiss√µes.</p>

<p>Acessando o <strong>MySQL</strong> com usu√°rio root e informando a senha (informado na instala√ß√£o).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">CREATE USER slave IDENTIFIED BY "user-rifeli";

GRANT replication SLAVE, replication CLIENT ON *.* TO slave@'IP-LEONARDORIFELI-002' IDENTIFIED BY 'user-rifeli';

GRANT replication SLAVE, replication CLIENT ON *.* TO slave@'IP-LEONARDORIFELI-003' IDENTIFIED BY 'user-rifeli';

FLUSH PRIVILEGES;</code></pre></figure>

<p>Criamos o usu√°rio <strong>slave</strong> que responder√° pela senha <strong>user-rifeli</strong>.</p>

<p>Enfim, o servidor <strong>Master</strong> encontra-se configurado.</p>

<h4 id="3-configura√ß√£o-nos-servidores-que-atuar√£o-em-modo-slave">3. Configura√ß√£o nos servidores que atuar√£o em modo Slave</h4>

<p>O processo de configura√ß√£o √© an√°logo para ambos servidores, alterando apenas o <strong>server-id</strong> na configura√ß√£o.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span><span class="nb">cd</span> /etc/mysql
<span class="nv">$ </span>nano my.cnf</code></pre></figure>

<p>Ser√° necess√°rio editar o arquivo <strong>my.cnf</strong>, da seguinte maneira:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">log-bin = mysql-bin
server-id = number-slave
relay-log = mysql-relay-bin
log-slave-updates = 1</code></pre></figure>

<p>O <strong>server-id</strong> ser√° igual a <strong>2</strong> para a inst√¢ncia <strong>leonardorifeli-002</strong> e igual a <strong>3</strong> para a inst√¢ncia  <strong>leonardorifeli-003</strong>.</p>

<p>Ap√≥s editar, executamos o comando abaixo (para reiniciar o servidor MySQL):</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>service mysql restart</code></pre></figure>

<h4 id="4-informar-para-os-servidores-slaves-qual-ser√°-o-servidor-master">4. Informar para os servidores Slaves qual ser√° o servidor Master</h4>

<p>Acessando o MySQL com usu√°rio root e informando a senha (informado na instala√ß√£o).</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">$ </span>mysql <span class="nt">-u</span> root <span class="nt">-p</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-mysql" data-lang="mysql">CHANGE MASTER TO MASTER_HOST='IP-LEONARDORIFELI-001',
MASTER_USER='slave',
MASTER_PASSWORD='user-rifeli',
MASTER_LOG_FILE='mysql-bin.000001',
MASTER_LOG_POS=0;</code></pre></figure>

<p><strong>PS:</strong> Conforme j√° informado, este processo √© an√°logo para ambos servidores</p>

<h2 id="testando-a-replica√ß√£o">Testando a replica√ß√£o</h2>

<p>No servidor <strong>leonardorifeli-001</strong> foi criado o banco <strong>leonardorifeli</strong>, conforme abaixo:</p>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-mysql-replication-master.png" />
	<br />
	<b>Servidor Master (leonardorifeli-001) - Figura 1.4</b>
</div>

<p>Ap√≥s esse processo, foi verificado os bancos contidos nos servidores slaves, e foi relatado que a replica√ß√£o foi um sucesso. Conforme abaixo:</p>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-mysql-replication-slave-01.png" />
	<br />
	<b>Servidor Slave (leonardorifeli-002) - Figura 1.5</b>
</div>

<div style="text-align:center">
	<img class="image" src="/img/posts/2015-11-01-mysql-replication-slave-02.png" />
	<br />
	<b>Servidor Slave (leonardorifeli-003) - Figura 1.6</b>
</div>

<h2 id="refer√™ncias-bibliogr√°ficas">Refer√™ncias Bibliogr√°ficas</h2>

<p>Abaixo seguem as refer√™ncias bibliogr√°ficas utilizadas:</p>

<ol>
  <li><a href="http://dev.mysql.com/doc/refman/5.6/en/replication.html" target="_blank">Documenta√ß√£o do MySQL</a></li>
  <li><a href="http://www.vivaolinux.com.br/dica/Configurando-acesso-remoto-em-servidores-MySQL" target="_blank">Configurando acesso remoto ao MySQL</a></li>
</ol>

<h2 id="conclus√£o">Conclus√£o</h2>

<p>Recomenda-se o uso da replica√ß√£o apenas para aplica√ß√µes robustas que necessitam de redund√¢ncia ou backup em tempo real e neste caso o servidor <strong>Slave</strong> pode efetuar um backup compactado do banco de dados e enviar para um <strong>Storage no Amazon S3</strong>, por exemplo.</p>

<p>Apenas salientando, a replica√ß√£o funciona somente de <strong>Master</strong> para <strong>Slave</strong> (conforme <strong>Figura 1.1 e 1.3</strong>) e n√£o o contr√°rio.</p>

<h2 id="informa√ß√µes-adicionais">Informa√ß√µes Adicionais</h2>

<p>Este artigo surgiu para aplica√ß√£o e documenta√ß√£o dos assuntos abordados e como sempre, transfer√™ncia de conhecimentos.</p>

<p>Espero que as informa√ß√µes supramencionadas sejam √∫teis.</p>

<p>Fa√ßam seus coment√°rios no espa√ßo abaixo e compartilhe este post.</p>

<p>Abra√ßos e at√© o pr√≥ximo post.</p>
:ET